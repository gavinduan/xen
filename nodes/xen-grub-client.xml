<?xml version="1.0" standalone="no"?>

<kickstart roll="base">

  <description>

  Boot loader configuration for (Xen) cluster appliances.

  </description>

        <copyright>
        Copyright (c) 2000 - 2008 The Regents of the University of California.
        All rights reserved. Rocks(r) v5.0 www.rocksclusters.org
        </copyright>

  <changelog>
  $Log: xen-grub-client.xml,v $
  Revision 1.1  2008/08/28 04:38:13  phil
  Detect that we are kickstarting inside of a VM container. Adjust rocks.conf
  to boot xen installable kernel

  </changelog>
<!--Get the Xen Boot Kernel, Initrd installed --> 
<package>rocks-boot-xen</package>

<!-- Setup /boot/grub/rocks.conf file -->
<!-- this happens after the grub-client runs. We just need to adjust the 
install and ramdisk for kickstart installation -->

<post arg="--interpreter /opt/rocks/bin/python">
import os
import rocks.grub

isXen = False
detectXen1 = '/sbin/lsmod | /bin/grep xen'
detectXen2 = '/sbin/lspci'

for mods in os.popen(detectXen1).readlines():
	isXen = True

for devs in os.popen(detectXen2).readlines():
	isXen = False

if isXen:
	args = "ks initrd=initrd.img pxe selinux=0 noipv6 lang= devfs=nomount"
	makegrub=rocks.grub.App()
	makegrub.setBootTitle('Rocks Reinstall Xen')
	makegrub.setInstallKernel('kickstart/xen/vmlinuz')
	makegrub.setInstallRamdisk('kickstart/xen/initrd-xen.iso.gz')
	makegrub.run(args)

</post>
</kickstart> 

